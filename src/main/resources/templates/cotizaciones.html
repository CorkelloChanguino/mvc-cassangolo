<!DOCTYPE html>
<html lang="es">

<head th:replace="layout :: head" th:with="titulo='Cotizaciones'"></head>

<body class="color-fondo">

    <nav th:replace="layout :: navbar"></nav>

    <div class="container mt-4">

        <h2 class="mb-4">Cotizaciones</h2>

        <div class="card">
            <div class="card-header bg-dark text-white">Listado</div>

            <div class="card-body p-0">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th># Cotización</th>
                            <th>Lote</th>
                            <th>Fecha</th>
                            <th>Total</th>
                            <th>Vendedor</th>
                            <th class="text-center" style="width: 80px;">Acciones</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr th:each="c : ${cotizaciones}">
                            <td th:text="${c.numeroCotizacion}"></td>

                            <!-- Lote en formato: Etapa-Mz-Lote -->
                            <td th:text="${c.lote.etapa + '-' + c.lote.manzana + '-' + c.lote.numero}"></td>

                            <td th:text="${#temporals.format(c.fecha, 'dd/MM/yyyy HH:mm')}"></td>


                            <td th:text="${c.precioTotal}"></td>

                            <!-- Añadido: vendedor tolerante a null -->
                            <td>
                                <span th:if="${c.vendedor != null}" th:text="${c.vendedor.username}"></span>
                                <span th:unless="${c.vendedor != null}">—</span>
                            </td>



                            <!-- Botón PDF con ícono -->
                            <td class="text-center">
                                <a class="btn btn-danger btn-sm" title="Descargar PDF"
                                    th:href="@{/cotizaciones/pdf/{id}(id=${c.id})}">
                                    <i class="bi bi-filetype-pdf"></i>
                                </a>
                            </td>
                        </tr>
                    </tbody>

                </table>
            </div>
        </div>

    </div>

    <footer th:replace="layout :: footer"></footer>
    <div th:replace="layout :: scripts"></div>

</body>

</html>